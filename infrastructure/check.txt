# MILVUS EC2 INSTANCE
module "milvus_ec2" {
  source = "./modules/milvus_ec2"

  project_name          = "cs480fyp"
  environment           = var.environment
  vpc_id                = module.networking.vpc_id
  subnet_id             = module.networking.public_subnet_ids[0]
  ecs_security_group_id = module.ecs_security_group.ecs_service_sg_id

  instance_type    = "t3.large"
  volume_size      = 30
  data_volume_size = 100
  key_name         = var.key_name
  ssh_cidr_blocks  = ["0.0.0.0/0"] # Restrict this in production
}

# ==========================================
# Milvus Outputs
# ==========================================
output "milvus_instance_id" {
  description = "Milvus EC2 instance ID"
  value       = module.milvus_ec2.instance_id
}

output "milvus_private_ip" {
  description = "Private IP address of the Milvus instance"
  value       = module.milvus_ec2.private_ip
}

output "milvus_public_ip" {
  description = "Public IP address of the Milvus instance (Elastic IP)"
  value       = module.milvus_ec2.public_ip
}

output "milvus_endpoint" {
  description = "Milvus endpoint for connecting from ECS services"
  value       = module.milvus_ec2.milvus_endpoint
}

output "milvus_admin_endpoint" {
  description = "Milvus admin endpoint for monitoring"
  value       = module.milvus_ec2.milvus_admin_endpoint
}